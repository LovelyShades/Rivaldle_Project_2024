{"version":3,"file":"to-chinese.js","sources":["../../src/to-chinese.ts"],"sourcesContent":["import { NumberToChineseOptions, normalizeOptions } from \"./options\";\nimport { getLabels, NumberToChineseLabels } from \"./label\";\n\ninterface LabelRegexps {\n  onlyZero: [RegExp, string];\n  zeroBetweenBigUnits: [RegExp, string];\n  zeroBetweenSmallAndBigUnits: [RegExp, string];\n  groupZero: [RegExp, string];\n  removeTailZero: [RegExp, string];\n  removeOne: [RegExp, string];\n}\n\nconst regexps = new WeakMap<NumberToChineseLabels, LabelRegexps>();\n\nfunction getRegexps(labels: NumberToChineseLabels): LabelRegexps {\n  const r = regexps.get(labels);\n\n  if (r) {\n    return r;\n  }\n\n  const { digits, units } = labels;\n  const smallUnit = units[1] + units[2] + units[3];\n  const bigUnit = units[4] + units[8] + units[12] + units[16] + units[20];\n  const zero = digits[0];\n\n  const v: LabelRegexps = {\n    // 零千,零百,零十 keeps 零\n    onlyZero: [new RegExp(`(${zero})[${smallUnit}]`, \"g\"), \"$1\"],\n    //大數中間沒細數，補零\n    zeroBetweenBigUnits: [\n      new RegExp(`([${bigUnit}])[^${smallUnit}]+([${bigUnit}])`, \"g\"),\n      \"$1\" + zero,\n    ],\n    zeroBetweenSmallAndBigUnits: [\n      new RegExp(`([${smallUnit}])${zero}+([${bigUnit}])`, \"g\"),\n      \"$1$2\" + zero,\n    ],\n    //group 零\n    groupZero: [new RegExp(`(${digits[0]})+`, \"g\"), \"$1\"],\n    // remove tail zero\n    removeTailZero: [new RegExp(zero + \"+$\"), \"\"],\n    // 一十 => 十\n    removeOne: [new RegExp(`^${digits[1]}${units[1]}`), units[1]],\n  };\n  regexps.set(labels, v);\n\n  return v;\n}\n\nfunction parseIntPart(\n  num: number,\n  labels: NumberToChineseLabels,\n  keepOne: boolean,\n) {\n  const { digits, units, minus } = labels;\n\n  const regexps = getRegexps(labels);\n\n  let n = Math.floor(Math.abs(num));\n\n  // 0\n  if (n < 1) return (num < 0 ? minus : \"\") + digits[0];\n\n  let str = \"\";\n  let unitIndex = 0;\n  while (n > 0) {\n    str = digits[n % 10] + units[unitIndex] + str;\n\n    n = Math.floor(n / 10);\n    unitIndex++;\n  }\n\n  str = str\n    .replace(...regexps.onlyZero)\n    .replace(...regexps.zeroBetweenBigUnits)\n    .replace(...regexps.zeroBetweenSmallAndBigUnits)\n    .replace(...regexps.groupZero)\n    .replace(...regexps.removeTailZero);\n\n  if (keepOne != true) {\n    str = str.replace(...regexps.removeOne);\n  }\n\n  return (num < 0 ? minus : \"\") + str;\n}\n\nfunction parseFloatPart(num: number, labels: NumberToChineseLabels): string {\n  if (num % 1 === 0) return \"\";\n\n  num = Math.abs(num);\n  const { digits, point } = labels;\n\n  let numStr = num.toString();\n  numStr = numStr.slice(numStr.indexOf(\".\") + 1);\n\n  let str = \"\";\n  for (const d of numStr) {\n    str = str + digits[parseInt(d)];\n  }\n\n  return point + str;\n}\n\nexport function numberToChinese(\n  num: number,\n  options?: NumberToChineseOptions,\n): string {\n  const opts = normalizeOptions(options);\n  const labels = getLabels(opts);\n  return parseIntPart(num, labels, opts.keepOne) + parseFloatPart(num, labels);\n}\n"],"names":["regexps","WeakMap","getRegexps","labels","r","get","digits","units","smallUnit","bigUnit","zero","v","onlyZero","RegExp","zeroBetweenBigUnits","zeroBetweenSmallAndBigUnits","groupZero","removeTailZero","removeOne","set","parseIntPart","num","keepOne","minus","n","Math","floor","abs","str","unitIndex","replace","parseFloatPart","point","numStr","toString","slice","indexOf","d","parseInt","numberToChinese","options","opts","normalizeOptions","getLabels"],"mappings":"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"}